<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Stanforis — Committees</title>
<link href="../../css/output.css" rel="stylesheet"><style>:root{color-scheme:dark light}</style>
</head>
<body class="bg-neutral-950 text-neutral-100">
<div class="mx-auto max-w-md min-h-screen relative">
<header class="sticky top-0 bg-neutral-900/80 border-b"><div class="flex items-center px-4 h-16"><button onclick="openPage('dashboard.html')" class="p-2 rounded-xl bg-neutral-800">←</button><div class="flex-1"><p class="text-xs text-neutral-400">Committees</p><p class="font-medium">Manage local committees</p></div><button id="btnNew" class="p-2 rounded-xl bg-emerald-600">＋</button></div></header>
<main class="px-4 pt-4 pb-24 space-y-4">
<section class="rounded-2xl border bg-neutral-900 p-4">
<div class="flex gap-2"><input id="q" placeholder="Search committee" class="flex-1 p-2 rounded-xl bg-neutral-800 border"/><button id="btnSearch" class="py-2 px-3 rounded-xl bg-neutral-800">Search</button></div>
</section>
<section class="rounded-2xl border bg-neutral-900 p-4">
<h3 class="font-medium">Committees</h3><div id="list" class="space-y-2 text-sm text-neutral-400">Loading...</div>
</section>
</main>
<footer class="fixed bottom-0 inset-x-0 bg-neutral-900 border-t"><div class="max-w-md mx-auto"><div class="grid grid-cols-5 text-[9px]"><a href="dashboard.html">Mudugudu</a><a href="devices.html">Devices</a><a href="automation.html">Scenes</a><a href="notifications.html">Alerts</a><a href="settings.html">⚙️</a></div><div class="bg-neutral-950 text-[8px] text-neutral-500 text-center py-2">©<span id="y"></span> Stanforis Rwanda</div></div></footer>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        /* ========== Set Footer Year ========== */
        document.getElementById('y').textContent = new Date().getFullYear();

        /* ========== Firebase Configuration ========== */
        const firebaseConfig = {
            apiKey: "FIREBASE_API_KEY",
            authDomain: "PROJECT.firebaseapp.com",
            databaseURL: "https://PROJECT-default-rtdb.firebaseio.com",
            projectId: "PROJECT",
            storageBucket: "PROJECT.appspot.com",
            messagingSenderId: "SENDER_ID",
            appId: "APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Firebase services
        const auth = firebase.auth();
        const db   = firebase.database();
        const ref  = db.ref('committees');  // Reference to committees

        // Local cache
        let cache = {};

        /* ========== Authentication Check ========== */
        // auth.onAuthStateChanged(user => {
        //     if (!user) {
        //         // Redirect if not signed in
        //         location.href = 'login.html';
        //     } else {
        //         init();
        //     }
        // });

        /* ========== Initialize Page ========== */
        function init() {
            // Bind buttons
            document.getElementById('btnNew').addEventListener('click', addPrompt);
            document.getElementById('btnSearch').addEventListener('click', search);

            // Load committees from Firebase in real-time
            ref.on('value', snapshot => {
                cache = snapshot.val() || {};
                render();
            });
        }

        /* ========== Render Committees List ========== */
        function render() {
            const rows = Object.entries(cache)
                .map(([id, committee]) => `
                    <div class="p-2 rounded-xl bg-neutral-900 border flex justify-between items-center">
                        <div class="min-w-0">
                            <div class="font-medium">${escape(committee.name)}</div>
                            <div class="text-xs text-neutral-400">${escape(committee.mandate || '')}</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="openCommit('${id}')" class="px-2 py-1 rounded-md bg-neutral-800 text-xs">Open</button>
                            <button onclick="del('${id}')" class="px-2 py-1 rounded-md bg-rose-600 text-xs">Del</button>
                        </div>
                    </div>
                `)
                .join('');

            document.getElementById('list').innerHTML = rows || '<div class="text-xs text-neutral-500">No committees</div>';
        }

        /* ========== Add New Committee ========== */
        function addPrompt() {
            const name = prompt('Committee name');
            if (!name) return;

            const mandate = prompt('Mandate') || '';
            const newRef = ref.push();
            newRef.set({
                name,
                mandate,
                members: [],
                createdAt: firebase.database.ServerValue.TIMESTAMP
            });
        }

        /* ========== Open Committee Details Page ========== */
        function openCommit(id) {
            window.location.href = 'committees.detail.html?id=' + encodeURIComponent(id);
        }

        /* ========== Delete Committee ========== */
        function del(id) {
            if (!confirm('Delete committee?')) return;
            ref.child(id).remove();
        }

        /* ========== Search Committees ========== */
        function search() {
            const q = (document.getElementById('q').value || '').toLowerCase().trim();
            const items = Object.entries(cache)
                .filter(([id, c]) => (c.name || '').toLowerCase().includes(q))
                .map(([id, c]) => `
                    <div class="p-2 rounded-xl bg-neutral-900 border flex justify-between items-center">
                        <div>
                            <div class="font-medium">${escape(c.name)}</div>
                        </div>
                        <div>
                            <button onclick="openCommit('${id}')">Open</button>
                        </div>
                    </div>
                `)
                .join('');

            document.getElementById('list').innerHTML = items || '<div class="text-xs text-neutral-500">No results</div>';
        }

        /* ========== Placeholder for Future: Delete Committee Member ========== */
        function delMember(cId, uid) { }

        /* ========== Utilities ========== */
        // Escape HTML to prevent injection
        function escape(s) {
            return (s || '').replace(/[&<>"']/g, m => ({
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;'
            }[m]));
        }

        // Navigate to another page
        function openPage(p) {
            location.href = p;
        }
    </script>

</body>
</html>
